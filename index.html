<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Barcode Scanner</title>
  
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
  
  <!-- QuaggaJS -->
  <script src="https://unpkg.com/quagga/dist/quagga.min.js"></script>
</head>
<body>

<!-- Button to trigger barcode scanner -->
<button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#barcodeScannerModal">
  Open Barcode Scanner
</button>

<!-- Modal -->
<div class="modal fade" id="barcodeScannerModal" tabindex="-1" aria-labelledby="barcodeScannerModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="barcodeScannerModalLabel">Scan Barcode</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div id="barcode-scanner-container">
          <video id="barcode-scanner" style="width: 100%;"></video>
        </div>
        <p id="barcode-result">Scan a barcode!</p>
      </div>
    </div>
  </div>
</div>

<script>
  // Initialize QuaggaJS barcode scanner
  function startBarcodeScanner() {
    Quagga.init({
      inputStream: {
        name: "Live",
        type: "LiveStream",
        target: document.querySelector('#barcode-scanner'), // Where the video should appear
        constraints: {
          facingMode: "environment" // Use the rear camera
        }
      },
      decoder: {
        readers: ["code_128_reader", "ean_reader", "ean_8_reader", "code_39_reader", "code_93_reader"]
      },
      locate: true
    }, function(err) {
      if (err) {
        console.log(err);
        alert("Barcode scanner failed to start.");
        return;
      }
      Quagga.start();
    });

    // Listen for barcode detected event
    Quagga.onDetected(function(result) {
      document.getElementById('barcode-result').textContent = 'Barcode Detected: ' + result.codeResult.code;
    });
  }

  // Open the modal and start scanner when modal is shown
  var barcodeScannerModal = document.getElementById('barcodeScannerModal');
  barcodeScannerModal.addEventListener('shown.bs.modal', function() {
    startBarcodeScanner();
  });

  // Stop scanner when modal is hidden
  barcodeScannerModal.addEventListener('hidden.bs.modal', function() {
    Quagga.stop();
  });
</script>

<!-- Bootstrap JS (Required for modal functionality) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>
